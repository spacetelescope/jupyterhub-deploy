#! /bin/bash

set -eu

cd $JUPYTERHUB_DIR

case "${ENVIRONMENT}" in
    dev | test | prod) 
	export EFSQ_SECRETS=$(secrets-cat)
       python - <<FILTER
import os      
import yaml    
       
x = yaml.safe_load(os.environ["EFSQ_SECRETS"])

print(x["jupyterhub"]["hub"]["services"]["efs-quota"]["api_token"])
FILTER
	;;
    *)
	export EFSQ_SECRETS=$(cat values.yaml)
       python - <<FILTER
import os      
import yaml    
       
x = yaml.safe_load(os.environ["EFSQ_SECRETS"])

print(x["jupyterhub"]["hub"]["services"]["efs-quota"]["api_token"])
FILTER
	;;
esac

